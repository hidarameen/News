# نظام إدارة القنوات - Telegram Bot

## الميزات المضافة

تم إضافة نظام كامل لإدارة القنوات يسمح لكل مستخدم بإدارة قنواته الخاصة بشكل منفصل:

### 🌟 الوظائف الرئيسية:

1. **إضافة القنوات** - يمكن للمستخدم إضافة قنواته عبر:
   - إرسال معرف القناة (`@channel_username`)
   - إرسال رابط القناة (`https://t.me/channel_username`)
   - إرسال ID القناة الرقمي
   - توجيه رسالة من القناة مباشرة للبوت
   - إضافة عدة قنوات دفعة واحدة (كل قناة في سطر منفصل)

2. **عرض القنوات** - عرض جميع القنوات المضافة مع:
   - اسم القناة الفعلي
   - معرف القناة
   - ID القناة

3. **حذف القنوات** - إمكانية حذف أي قناة من القائمة

4. **التحقق من الصلاحيات** - البوت يتحقق تلقائياً من أنه مشرف في القناة قبل إضافتها

## 📁 الملفات المضافة/المعدلة:

### 1. `/app/bot/channels.py` (جديد)
- يحتوي على class `ChannelManager` لإدارة عمليات القنوات
- معالجات الأزرار والأوامر الخاصة بالقنوات
- التحقق من صلاحيات البوت في القنوات

### 2. `/app/bot/handlers.py` (معدل)
- إضافة زر "📡 القنوات" في القائمة الرئيسية
- إضافة معالج للأمر `/channels`
- إضافة معالجات callback للأزرار
- نظام حالات المستخدمين لانتظار إدخال القنوات

### 3. `/app/db/migrate.py` (معدل)
- إضافة جدول `channels` لحفظ قنوات المستخدمين
- الجدول يحفظ: معرف المستخدم، معرف القناة، اسم القناة، معرف القناة، حالة الإدارة

## 🚀 التشغيل:

### 1. إعداد قاعدة البيانات

```bash
# تشغيل PostgreSQL و Redis باستخدام Docker
docker compose up -d postgres redis

# أو إذا كان لديك PostgreSQL محلياً، قم بتحديث DATABASE_URL في .env
```

### 2. تثبيت المكتبات

```bash
pip install -r requirements.txt
```

### 3. إعداد متغيرات البيئة

أنشئ ملف `.env` وأضف:

```env
BOT_TOKEN=YOUR_BOT_TOKEN_HERE
API_ID=YOUR_API_ID_HERE
API_HASH=YOUR_API_HASH_HERE
DATABASE_URL=postgresql://bot:bot@localhost:5432/botdb
REDIS_URL=redis://localhost:6379/0
```

### 4. تشغيل Migrations

```bash
python -m app.db.migrate
```

### 5. تشغيل البوت

```bash
python -m app.bot.client
```

## 📱 كيفية الاستخدام:

1. **ابدأ البوت**: أرسل `/start`
2. **اضغط على زر "📡 القنوات"**
3. **اختر من القائمة**:
   - ➕ إضافة قنوات
   - 📋 عرض قنواتي
   - 🗑 حذف قناة

### إضافة قناة:

1. اضغط "➕ إضافة قنوات"
2. أرسل القناة بإحدى الطرق:
   - معرف القناة: `@mychannel`
   - رابط القناة: `https://t.me/mychannel`
   - ID القناة: `-1001234567890`
   - وجّه رسالة من القناة

**ملاحظة مهمة**: يجب أن يكون البوت مشرفاً في القناة قبل إضافتها!

### إضافة عدة قنوات:

يمكنك إرسال عدة قنوات دفعة واحدة:

```
@channel1
@channel2
https://t.me/channel3
-1001234567890
```

## 🔒 الأمان:

- كل مستخدم يمكنه إدارة قنواته الخاصة فقط
- البوت يتحقق من صلاحياته قبل إضافة أي قناة
- البيانات محفوظة بشكل آمن في قاعدة البيانات

## 🛠 التطوير المستقبلي:

يمكن إضافة المزيد من الميزات مثل:
- إحصائيات القنوات
- جدولة الرسائل للقنوات
- نسخ احتياطي للقنوات
- تصدير/استيراد قائمة القنوات

## 📝 ملاحظات تقنية:

- تم استخدام `psycopg3` بدلاً من `asyncpg` للتوافق مع Python 3.13
- النظام يدعم العمل مع PostgreSQL
- جميع العمليات غير متزامنة (async) لأداء أفضل

## 🤝 المساهمة:

لإضافة ميزات جديدة أو تحسينات:
1. قم بإنشاء فرع جديد
2. أضف التحسينات
3. اختبر التغييرات
4. أرسل Pull Request

---

تم تطوير هذا النظام بواسطة مساعد AI 🤖